<!-- <!DOCTYPE html>
<html>
  <head>
    <title>Create Recipe</title>
  </head>
  <body>
    <h1>Create a new recipe</h1>
    <form action="/createRecipe" method="POST">
      <label for="title">Recipe Title:</label><br>
      <input type="text" id="title" name="title" required><br>
      <label for="ingredients">Ingredients (separate each ingredient with a comma):</label><br>
      <textarea id="ingredients" name="ingredients" required></textarea><br>
      <label for="instructions">Instructions:</label><br>
      <textarea id="instructions" name="instructions" required></textarea><br>
      <input type="hidden" id="user" name="user" value="65748e945441b65b7455a7a0">
      <input type="submit" value="Create Recipe">
    </form>
  </body>
</html> -->

<!DOCTYPE html>
<html>
<head>
    <title>Create Recipe</title>
</head>
<body>

    <h1>Your Recipes</h1>
    <div id="userRecipes"></div>

    <hr/>

    <h1>Create a new recipe</h1>
    <form id="recipeForm">
        <label for="title">Recipe Title:</label><br>
        <input type="text" id="title" required><br>
        <label>Ingredients:</label><br>
        <div id="ingredients">
            <div id="ingredient-0">
                <input type="text" name="ingredient" required>
                <button type="button" onclick="this.parentElement.remove()">Remove ingredient</button><br>
            </div>
        </div>
        <button type="button" onclick="addIngredientField()">Add Ingredient</button><br>
        <label>Instructions:</label><br>
        <div id="instructionsDiv">
            <div id="instruction-0">
                <textarea name="instruction" required></textarea>
                <button type="button" onclick="this.parentElement.remove()">Remove instruction</button><br>
            </div>
        </div>
        <button type="button" onclick="addInstructionField()">Add Instruction</button><br>
        <input type="hidden" id="user" value="65748e945441b65b7455a7a0">
        <input type="submit" value="Create Recipe">
    </form>

    <script>
      const currentUserId = '65748e945441b65b7455a7a0'; // replace this with logic to get current logged-in user's id

      function getRecipes() {
          fetch('http://localhost:3000/recipes')
          .then(response => response.json())
          .then(data => {
              const userRecipesDiv = document.getElementById('userRecipes');
              data.forEach(recipe => {
                  if (recipe.user === currentUserId) {
                      const recipeParagraph = document.createElement('p');
                      let ingredients = recipe.ingredients.join(", ");
                      let instructions = recipe.instructions.join(". ");
                      recipeParagraph.textContent = `Title: ${recipe.title}, Ingredients: ${ingredients}, Instructions: ${instructions}`;

                      const editButton = document.createElement('button');
                      editButton.textContent = 'Edit';
                      editButton.onclick = function() {
                          // Logic to handle editing the recipe...
                      };

                      const deleteButton = document.createElement('button');
                      deleteButton.textContent = 'Delete';
                      deleteButton.onclick = function() {
                          // Logic to handle deleting the recipe...
                      };

                      userRecipesDiv.appendChild(recipeParagraph);
                      userRecipesDiv.appendChild(editButton);
                      userRecipesDiv.appendChild(deleteButton);
                  }
              });
          })
          .catch(error => console.error(error));
      }

      
      let ingredientId = 0;

      function addIngredientField() {
          const ingredientsDiv = document.getElementById('ingredients');
          const newDiv = document.createElement('div');
          newDiv.id = `ingredient-${ingredientId}`;

          const newInput = document.createElement('input');
          newInput.type = 'text';
          newInput.name = 'ingredient';

          const newButton = document.createElement('button');
          newButton.type = "button";
          newButton.textContent = "Remove ingredient";
          newButton.onclick = function () {
              document.getElementById(newDiv.id).remove();
          };

          newDiv.appendChild(newInput);
          newDiv.appendChild(newButton);
          ingredientsDiv.appendChild(newDiv);
          ingredientId++;
      }

      let instructionId = 0;

      function addInstructionField() {
          const instructionsDiv = document.getElementById('instructionsDiv');
          const newDiv = document.createElement('div');
          newDiv.id = `instruction-${instructionId}`;

          const newInput = document.createElement('textarea');
          newInput.name = 'instruction';

          const newButton = document.createElement('button');
          newButton.type = "button";
          newButton.textContent = "Remove instruction";
          newButton.onclick = function () {
              document.getElementById(newDiv.id).remove();
          };

          newDiv.appendChild(newInput);
          newDiv.appendChild(newButton);
          instructionsDiv.appendChild(newDiv);
          instructionId++;
      }

      function submitRecipe() {
        const title = document.getElementById('title').value;
        const user = document.getElementById('user').value;
        const ingredients = Array.from(document.getElementsByName('ingredient')).map(input => input.value);
        const instructions = Array.from(document.getElementsByName('instruction')).map(input => input.value);

        const recipe = {
            title,
            instructions,
            user,
            ingredients
        };

          fetch('/createRecipe', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify(recipe)
          })
          .then(response => response.text())
          .then(text => console.log(text))
          .catch(error => console.error(error));
      }

      window.onload = function() {
          document.getElementById('recipeForm').addEventListener('submit', function(event) {
              event.preventDefault();
              submitRecipe();
          });
          getRecipes();
      }
  </script>
</body>
</html>